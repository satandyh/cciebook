---
description: 'Цикл 19, Тема 114: BGP'
---

# Лабораторная по теме 114

{% file src="../../.gitbook/assets/lab114.zip" caption="Начальная конфигурация" %}

1. Задание объединенное для тем 112 и 114
2. Загрузить начальную конфигурацию всех устройств.
3. Для задания используется логическая и физическая топологии проекта.
4. На маршрутизаторах R1, R2 настроить OSPF процесс 100 в Аrea 12, на следующих интерфейсах:
   1. R1- E0/1.12, Интерфейс Loopback0
   2. R2- E0/1.12
5. На маршрутизаторах R2, R3 настроить OSPF процесс 100 в Аrea 23, на следующих интерфейсах:
   1. R2- E0/1.23, Интерфейс Loopback0
   2. R3- E0/1.23, Интерфейс Loopback0
6. На маршрутизаторах R3, R4 настроить OSPF процесс 100 в Аrea 34, на следующих интерфейсах:
   1. R3- E0/1.34
   2. R4- E0/1.34
7. На маршрутизаторах R4, R6 настроить OSPF процесс 100 в Аrea 456 на следующих интерфейсах:
   1. R4 — E0/1.456, Интерфейс Loopback0
   2. R6 — E0/1.456, Интерфейс Loopback0
8. На маршрутизаторах R8,R9,R10 настроить OSPF процесс 100 в Аrea 108, на следующих интерфейсах:
   1. R8- E0/1.78, E0/1.89,Интерфейс Loopback0
   2. R9- E0/1.89, Интерфейс Loopback0, Интерфейс Multilink1
   3. R10- Интерфейс Loopback0, Интерфейс Multilink1
9. На маршрутизаторе R1 настроить BGP процесс следующим образом:
   1. Номер AS — 1
   2. Создать внешнюю bgp сессию следующим образом:
      1. Указать в качестве Remote AS номер 237
      2. Указать в качестве Update Source интерфейс Loopback0
      3. Позволить увеличение значения TTL только до 2 хопов
      4. Применить к маршрутизатору R2, указав IP адреса их Loopback интерфейсов
10. На маршрутизаторе R1 настроить статический маршрут к IP адресу интерфейса Loopback 0 маршрутизатора R2. В качестве Next Hop указать IP адрес интерфейса E0/1.12
11. На маршрутизаторе R2 настроить BGP процесс следующим образом:
    1. Номер AS — 237
    2. Редистрибьютить OSPF процесс 100 с метрикой 20
    3. Адвертайзить маршруты 188.1.235.0/24 и 180.1.1.1/32 не используя редистрибьютинг
    4. Создать внутренюю bgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название IBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. В качестве соседа указать IP адрес Loopback интерфейса маршрутизатора R3
          4. Настроить марщрутизатор таким образом, чтобы он менял атрибут BGP NEXT\_HOP на свой собственный Loopback адрес.
       2. Указать в качестве Update Source интерфейс Tunnel0
       3. В качестве соседа указать IP адрес Tunnel0 интерфейса маршрутизатора R7
    5. Создать внешнюю ebgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название EBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. Позволить увеличение значения TTL только до 2 хопов
          4. В качестве соседей указать IP адрес Loopback интерфейса маршрутизаторов R1, R5
12. На маршрутизаторе R2 настроить статические маршруты к IP адресам интерфейса Loopback 0 маршрутизаторов R1 и R5. В качестве Next Hop указать IP адреса интерфейсов E0/1.12 и E0/1.235 соответственно
13. На маршрутизаторе R3 настроить BGP процесс следующим образом:
    1. Номер AS — 237
    2. Редистрибьютить OSPF процесс 100 с метрикой 20
    3. Адвертайзить маршрут 188.1.235.0/24 не используя редистрибьютинг
    4. Создать внутренюю bgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название IBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. Позволить увеличение значения TTL только до 2 хопов
          4. В качестве соседа указать IP адрес Loopback интерфейса маршрутизатора R2
          5. Настроить марщрутизатор таким образом, чтобы он менял атрибут BGP NEXT\_HOP на свой собственный Loopback адрес.
       2. Указать в качестве Update Source интерфейс Tunnel0
       3. В качестве соседа указать IP адрес Tunnel0 интерфейса маршрутизатора R7
    5. Создать внешнюю ebgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название EBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. Позволить увеличение значения TTL только до 2 хопов
          4. В качестве соседей указать IP адрес Loopback интерфейса маршрутизаторов R4, R5
14. На маршрутизаторе R3 настроить статические маршруты к IP адресам интерфейса Loopback 0 маршрутизаторов R4 и R5. В качестве Next Hop указать IP адреса интерфейсов E0/1.34 и E0/1.235 соответственно
15. На маршрутизаторе R4 настроить BGP процесс следующим образом:
    1. Номер AS — 46
    2. Редистрибьютить OSPF процесс 100 с метрикой 20
    3. Создать внутренюю bgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название IBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. Позволить увеличение значения TTL только до 2 хопов
          4. В качестве соседа указать IP адрес Loopback интерфейса маршрутизатора R6
          5. Настроить марщрутизатор таким образом, чтобы он менял атрибут BGP NEXT\_HOP на свой собственный Loopback адрес.
    4. Создать внешнюю ebgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название EBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. Позволить увеличение значения TTL только до 2 хопов
          4. В качестве соседей указать IP адрес Loopback интерфейса маршрутизаторов R3, R5
       2. Указать в качестве Update Source интерфейс Tunnel0
       3. В качестве соседа указать IP адрес Tunnel0 интерфейса маршрутизатора R7
16. На маршрутизаторе R4 настроить статические маршруты к IP адресам интерфейса Loopback 0 маршрутизаторов R3 и R5. В качестве Next Hop указать IP адреса интерфейсов E0/1.34 и E0/1.456 соответственно
17. На маршрутизаторе R5 настроить BGP процесс следующим образом:
    1. Номер AS — 5
    2. Адвертайзить маршрут 188.1.235.0/24 не используя редистрибьютинг
    3. Создать внешние ebgp сессии следующим образом:
       1. Создать BGP Peer Group:
          1. Название EBGP237
          2. Указать в качестве Update Source интерфейс Loopback0
          3. Позволить увеличение значения TTL только до 2 хопов
          4. В качестве соседей указать IP адрес Loopback интерфейса маршрутизаторов R2, R3
       2. Создать BGP Peer Group:
          1. Название EBGP46
          2. Указать в качестве Update Source интерфейс Loopback0
          3. Позволить увеличение значения TTL только до 2 хопов
          4. В качестве соседей указать IP адрес Loopback интерфейса маршрутизаторов R4, R6
18. На маршрутизаторе R5 настроить статические маршруты к IP адресам интерфейса Loopback 0 маршрутизаторов R2, R3, R4, R5. В качестве Next Hop указать IP адреса интерфейсов E0/1.235 и E0/1.456 соответственно
19. На маршрутизаторе R6 настроить BGP процесс следующим образом:
    1. Номер AS — 46
    2. Адвертайзить маршрут 188.1.45.0/24 не используя редистрибьютинг
    3. Создать ibgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название IBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. В качестве соседа указать IP адрес Loopback интерфейса маршрутизатора R4
    4. Создать внешние ebgp сессии следующим образом:
       1. Создать BGP Peer Group:
          1. Название EBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. Позволить увеличение значения TTL только до 2 хопов
          4. В качестве соседей указать IP адрес Loopback интерфейса маршрутизаторов R5, R7
       2. Указать в качестве Update Source интерфейс Tunnel0
       3. В качестве соседа указать IP адрес Tunnel0 интерфейса маршрутизатора R7
20. На маршрутизаторе R6 настроить статические маршруты к IP адресам интерфейса Loopback 0 маршрутизаторов R5 и R7. В качестве Next Hop указать IP адреса интерфейсов E0/1.67 и E0/1.456 соответственно
21. На маршрутизаторе R7 настроить BGP процесс следующим образом:
    1. Номер AS — 237
    2. Адвертайзить маршруты 180.1.7.7/32, 188.1.67.0/24, 188.1.78.0/24 не используя редистрибьютинг
    3. Создать ebgp сессии следующим образом:
       1. Создать BGP Peer Group:
          1. Название GREEN
          2. Указать в качестве Update Source интерфейс Loopback0
          3. Позволить увеличение значения TTL только до 2 хопов
          4. В качестве соседа указать IP адрес Loopback интерфейса маршрутизаторов R6, R8
       2. Настроить VRF под названием BLUE:
          1. Address-Family IPv4
          2. Создать BGP Peer Group:
             1. Название BLUE
             2. Указать в качестве Update Source интерфейс Tunnel0
             3. Позволить увеличение значения TTL только до 2 хопов
             4. В качестве соседа указать IP адрес интерфейса Tunnel0 маршрутизаторов R4, R6
       3. Настроить VRF под названием RED:
          1. Address-Family IPv4
          2. Создать BGP Peer Group:
             1. Название RED
             2. Указать в качестве Update Source интерфейс Tunnel0
             3. В качестве соседа указать IP адрес Tunnel0 интерфейса маршрутизаторов R2, R3
22. На маршрутизаторе R7 настроить статические маршруты к IP адресам интерфейса Loopback 0 маршрутизаторов R6 и R8. В качестве Next Hop указать IP адреса интерфейсов E0/1.67 и E0/1.78 соответственно
23. На маршрутизаторе R8 настроить BGP процесс следующим образом:
    1. Номер AS — 108
    2. Редистрибьютить OSPF процесс 100 с метрикой 20
    3. Создать ibgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название IBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. В качестве соседа указать IP адрес Loopback интерфейсов маршрутизатора R9
    4. Создать внешнюю ebgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название EBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. Позволить увеличение значения TTL только до 2 хопов
          4. В качестве соседей указать IP адрес Loopback интерфейса маршрутизаторов R7
24. На маршрутизаторе R8 настроить статические маршруты к IP адресу интерфейса Loopback 0 маршрутизатора R7. В качестве Next Hop указать IP адрес интерфейса E0/1.78 соответственно
25. На маршрутизаторе R9 настроить BGP процесс следующим образом:
    1. Номер AS — 108
    2. Создать ibgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название IBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. В качестве соседа указать IP адрес Loopback интерфейсов маршрутизаторов R8, R10
26. На маршрутизаторе R10 настроить BGP процесс следующим образом:
    1. Номер AS — 108
    2. Создать ibgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название IBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. В качестве соседа указать IP адрес Loopback интерфейсов маршрутизаторов R9
27. Настроить DMVPN Phase 3 следующим образом:
    1. Настроить маршрутизатор R7 в качестве хаба DMVPN:
       1. Настроить интерфейс Tunnel0:
          1. Настроить VRF Forwarding под название BLUE
          2. IP адрес — 188.1.100.7/24
          3. Настроить значение MTU 1400
          4. Настроить Adjust MSS 1360
          5. Аутентификация NHRP — BGP
          6. Настроить динамическую поддержку мультикаста
          7. NHRP ID — 100
          8. Источник — интерфейс Ethernet 0/1.144
          9. Режим — GRE Multipoint
          10. Ключ туннеля 10000
       2. Настроить интерфейс Tunnel1:
          1. Настроить VRF Fotwarding под название RED
          2. IP адрес — 188.1.100.7/24
          3. Настроить значение MTU 1400
          4. Настроить Adjust MSS 1360
          5. Аутентификация NHRP — IBGP
          6. Настроить динамическую поддержку мультикаста
          7. NHRP ID — 200
          8. Источник — интерфейс Ethernet 0/1.144
          9. Режим — GRE Multipoint
          10. Ключ туннеля 20000
    2. Настроить маршрутизаторы R2, R3 качеcтве Spok’ов для VRF RED:
       1. Настроить интерфейс Tunnel0:
          1. IP адрес — использовать Overlay адрес топологии
          2. Аутентификация NHRP — IBGP
          3. Настроить динамическую поддержку мультикаста
          4. NHRP ID — 200
          5. В качестве сервера NHRP указать R7
          6. Источник — интерфейс Ethernet 0/1.144
          7. Ключ туннеля 20000
    3. Настроить маршрутизаторы R4, R6 качеcтве Spok’ов для VRF BLUE:
       1. Настроить интерфейс Tunnel0:
          1. IP адрес — использовать Overlay адрес топологии
          2. Аутентификация NHRP — EBGP
          3. Настроить динамическую поддержку мультикаста
          4. NHRP ID — 100
          5. В качестве сервера NHRP указать R7
          6. Источник — интерфейс Ethernet 0/1.144
          7. Ключ туннеля 10000
28. На маршрутизаторае R7 проверить таблицу маршрутизации BGP для VRF RED и BLUE
29. На маршрутизаторе R5 настроить приоритетность маршрутов пришедших от AS 108 следующим образом:
    1. Настроить IP AS-PATH ACL под номером 10 и разрешить AS 108
    2. Настроить Route Map под названием R4\_R5:
       1. Заматчить IP AS-PATH ACL под номером 10
       2. Применить значение Weigth равное 20000
    3. Настроить Route Map под названием R6\_R5:
       1. Заматчить IP AS-PATH ACL под номером 10
       2. Применить значение Weigth равное 50000
    4. Применить Route Map под названием R4\_R5 к соседу R4 в процессе BGP 5
    5. Применить Route Map под названием R6\_R5 к соседу R4 в процессе BGP 5
30. На маршрутизаторе R2 настроить приоритетность маршрута 180.1.2.2/32 в VRF RED R7 следующим образом:
    1. Настроить Prefix List’ы под названием Set\_Pref и номером 5, где разрешить 180.1.2.2/32
    2. Настроить Route Map под названием PREF:
       1. Заматчить Prefix List под названием Set\_Pref
       2. Применить значение Local Preference равное 500
       3. Применить на выходе к R7 в процессе BGP
31. На маршрутизаторе R3 настроить приоритетность маршрута 180.1.3.3/32 в VRF RED R7 следующим образом:
    1. Настроить ACL под номером 10, где разрешить 180.1.3.3/32
    2. Настроить Route Map под названием MED:
       1. Заматчить ACL под номером 10
       2. Применить значение MED 0
       3. Применить на выходе к R7 в процессе BGP
32. На маршрутизаторе R7 проверить результат.

