---
description: 'Цикл 21, Тема 124:MPLS'
---

# Лабораторная по теме 124

{% file src="../../.gitbook/assets/lab124.zip" caption="Начальная конфигурация" %}

1. Загрузить начальную конфигурацию всех устройств.
2. Для задания используется логическая и физическая топологии проекта.
3. На маршрутизаторах R1, R2 настроить OSPF процесс 100 в Аrea 21 на следующих интерфейсах c типом сети Point-to-Point:
   1. R1 — E0/1.12, Loopback0
   2. R2- E0/1.12, Loopback0
4. На маршрутизаторах R2 и R3 настроить статические маршруты к IP адресам Loopback 0 интерфесов друг друга, указав в качестве Next Hop IP адреса E0/1.23 интерфесов.
5. На маршрутизаторах R3, R4, R6, R7 настроить OSPF процесс 100 в Аrea 37, на следующих интерфейсах:
   1. R3- E0/1.34, Loopback0
   2. R4- E0/1.34, E0/1.456, Loopback0
   3. R6 — E0/1.67, E0/1.456, Loopback0
   4. R7 — E0/1.67, Loopback0
6. На маршрутизаторах R7, R8 настроить OSPF процесс 100 в Аrea 78 на следующих интерфейсах:
   1. R7- E0/1.78
   2. R8- E0/1.78
7. На маршрутизаторах R7 и R8 настроить статические маршруты к IP адресам Loopback 0 интерфесов друг друга, указав в качестве Next Hop IP адреса E0/1.78 интерфесов.
8. На маршрутизаторах R2, R5, R8 и настроить RIPv2:
   1. Настроить Passive интерфейсы по дефолту, кроме:
      1. На R2 — E0/1.23
      2. На R5 — E0/1.235
      3. На R8 — E0/1.78
   2. Настроить сети 180.1.0.0, 188.1.0.0
   3. Убрать автосуммирование
9. На маршрутизаторах R8, R9, R10 настроить OSPF процесс 100 в Аrea 108 на следующих интерфейсах:
   1. R8- E0/1.89, Loopback0
   2. R9- E0/1.89, Multilink1, Loopback0
   3. R10- Multilink1, Loopback0
10. На маршрутизаторe R7 настроить OSPF процесс 100 в Аrea 7 на следующем интерфейсе:
    1. R7- E0/1.7
11. На маршрутизаторе R1 настроить BGP процесс следующим образом:
    1. Номер AS — 21
    2. Создать внутренюю bgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название IBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. В качестве соседа указать IP адрес Loopback интерфейса маршрутизатора R2
          4. Настроить марщрутизатор таким образом, чтобы он менял атрибут BGP NEXT\_HOP на свой собственный Loopback адрес.
12. На маршрутизаторе R2 настроить BGP процесс следующим образом:
    1. Номер AS — 21
    2. Создать внутренюю bgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название IBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. В качестве соседа указать IP адрес Loopback интерфейса маршрутизатора R1
          4. Настроить марщрутизатор таким образом, чтобы он менял атрибут BGP NEXT\_HOP на свой собственный Loopback адрес.
    3. Создать внешнюю ebgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название EBGP
          2. Позволить увеличение значения TTL только до 2 хопов
          3. Указать в качестве Update Source интерфейс Loopback0
          4. В качестве соседа указать IP адрес Loopback0 интерфейса маршрутизатора R3
13. На маршрутизаторе R3 настроить BGP процесс следующим образом:
    1. Номер AS — 73
    2. Редистрибьютить маршруты из протокола RIP
    3. Создать внешнюю bgp сессию следующим образом:
       1. Указать в качестве Remote AS номера 21 и 5 соотвественно
       2. Указать в качестве Update Source интерфейс Loopback0
       3. Позволить увеличение значения TTL только до 2 хопов
       4. Применить к маршрутизаторам R2 и R5, указав IP адрес Loopback интерфейса
       5. Создать внутренюю bgp сессию следующим образом:
          1. Создать BGP Peer Group:
             1. Название IBGP
             2. Указать в качестве Update Source интерфейс Loopback0
             3. В качестве соседа указать IP адрес Loopback интерфейса маршрутизатора R7
             4. Настроить марщрутизатор таким образом, чтобы он менял атрибут BGP NEXT\_HOP на свой собственный Loopback адрес.
          2. Настроить VPN следующим образом:
             1. Настроить Address Family VPNv4
             2. Активировать соседа R7
             3. Испольховать Extended Community
          3. Настроить VRF BLUE следующим образом:
             1. Настроить Address Family VPNv4 VRF BLUE
             2. Редистрибьютить RIP
          4. Настроить VRF GREEN следующим образом:
             1. Настроить Address Family VPNv4 VRF GREEN
             2. Редистрибьютить RIP
14. На маршрутизаторе R5 настроить BGP процесс следующим образом:
    1. Номер AS — 5
    2. Создать внешнюю bgp сессию следующим образом:
       1. Указать в качестве Remote AS номер 73
       2. Указать в качестве Update Source интерфейс Loopback0
       3. Позволить увеличение значения TTL только до 2 хопов
       4. Применить к маршрутизатору R3, указав IP адрес Loopback интерфейса
15. На маршрутизаторе R7 настроить BGP процесс следующим образом:
    1. Номер AS — 73
    2. Редистрибьютить маршруты из протокола RIP
    3. Создать внутренюю bgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название IBGP
          2. Настроить марщрутизатор таким образом, чтобы он менял атрибут BGP NEXT\_HOP на свой собственный Loopback адрес.
       2. Указать в качестве Update Source интерфейс Loopback0
       3. В качестве соседей указать IP адрес Loopback0 интерфейса маршрутизатора R3
          1. Настроить VPN следующим образом:
             1. Настроить Address Family VPNv4
             2. Активировать соседа R3
             3. Испольховать Extended Community
          2. Настроить VRF BLUE следующим образом:
             1. Настроить Address Family VPNv4 VRF BLUE
             2. Редистрибьютить RIP
          3. Настроить VRF GREEN следующим образом:
             1. Настроить Address Family VPNv4 VRF GREEN
             2. Редистрибьютить RIP
    4. Создать внешнюю ebgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название EBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. Позволить увеличение значения TTL только до 2 хопов
          4. В качестве соседей указать IP адрес Loopback интерфейса маршрутизаторов R8
16. На маршрутизаторе R8 настроить BGP процесс следующим образом:
    1. Номер AS — 108
    2. Создать ibgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название IBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. В качестве соседа указать IP адрес Loopback интерфейсов маршрутизатора R9
    3. Создать внешнюю ebgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название EBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. Позволить увеличение значения TTL только до 2 хопов
          4. В качестве соседей указать IP адрес Loopback интерфейса маршрутизаторов R7
17. На маршрутизаторе R9 настроить BGP процесс следующим образом:
    1. Номер AS — 108
    2. Создать ibgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название IBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. В качестве соседа указать IP адрес Loopback интерфейсов маршрутизаторов R8, R10
18. На маршрутизаторе R10 настроить BGP процесс следующим образом:
    1. Номер AS — 108
    2. Создать ibgp сессию следующим образом:
       1. Создать BGP Peer Group:
          1. Название IBGP
          2. Указать в качестве Update Source интерфейс Loopback0
          3. В качестве соседа указать IP адрес Loopback интерфейсов маршрутизаторов R9
19. Настроить MPLS на маршрутизаторах R3, R4, R6, R7 следующим образом:
    1. Настроить MPLS глобально на всех маршрутизаторах
    2. На маршрутизаторе R3:
       1. Ограничить диапазон MPLS заголовков от 300 до 399
       2. Настроить интерфейсы E0/1.34 таким образом, чтобы они принимали участие в MPLS Label Switching
    3. На маршрутизаторе R4:
       1. Ограничить диапазон MPLS заголовков от 400 до 499
       2. Настроить интерфейсы E0/1.34, E0/1.456 таким образом, чтобы они принимали участие в MPLS Label Switching
    4. На маршрутизаторе R6:
       1. Ограничить диапазон MPLS заголовков от 600 до 699
       2. Настроить интерфейсы E0/1.67, E0/1.456 таким образом, чтобы они принимали участие в MPLS Label Switching
    5. На маршрутизаторе R7:
       1. Ограничить диапазон MPLS заголовков от 700 до 799
       2. Настроить интерфейсы E0/1.67 таким образом, чтобы они принимали участие в MPLS Label Switching
20. На маршрутизаторах R3 и R7 настроить RIPv2 через VRF следующим образом:
    1. Настроить VRF под названием BLUE
       1. Route Distinguisher 1:1
       2. Route Target \(Export/Import\) 1:1
       3. На R3 применить на интерфейсе E0/1.235
       4. На R7 применить на интерфейсе E0/1.7
    2. Настроить VRF под названием GREEN
       1. Route Distinguisher 1:2
       2. Route Target \(Export/Import\) 1:2
       3. На R3 применить на интерфейсе E0/1.23
       4. На R7 применить на интерфейсе E0/1.78
    3. Настроить Address Family VRF BLUE:
       1. Network 188.1.0.0
       2. Редистрибьютить маршруты из BGP 73
       3. Указать Default Metric 2
    4. Настроить Address Family VRF GREEN:
       1. Network 188.1.0.0
       2. Редистрибьютить маршруты из BGP 73
       3. Указать Default Metric 2

