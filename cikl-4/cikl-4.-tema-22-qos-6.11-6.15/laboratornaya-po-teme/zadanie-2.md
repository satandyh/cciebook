# Задание №2 по теме 16

{% file src="../../../.gitbook/assets/lab022\_task2.zip" caption="Начальная конфигурация" %}

#### Задание \#2 для лабораторной:

Загрузить начальную конфигурацию. В задании необходимо настроить:

* политики QoS для трафика в направлении от r1 к r5.
* политики настраиваются на r2, r3, r4 и проверяются с r1, отправляя трафик на r5.
* в обратном направлении, политики настраивать не нужно.
* все политики применяются к физическому интерфейсу Ethernet0/1 \(на r2, r3, r4\).

Легенда задания:

* Маршрутизатор r2 понимает только стандарт IP Precedence. И находится ближе всего к клиенту \(r1\), поэтому на нем выполняем классификацию пакетов и маркировку их IP Precedence
* Маршрутизатор r3 понимает оба стандарта, и IP Precedence и DiffServ. Он выполняет перемаркировку из IP Precedence в DiffServ по заданию
* Маршрутизатор r4 понимает только DiffServ. Ожидает от r3 пакеты с маркерами DSCP
* На всех маршрутизаторах, для одного и того же типа трафика, настроена одна и та же политика обслуживания на выход

В качестве проверок, на r1 можно, к примеру, использовать:

1. Для проверки ICMP: `ping 180.1.5.5 size 1450`
2. Для проверки HTTP: `telnet 180.1.5.5 80`
3. Для проверки UDP включить заготовленный IP SLA тест с номером 100 \(если начинаются какие-то нюансы со связью между устройствами, то лучше тест, после проверки, опять отключить\).

Для проверки работы политик используйте команду `show policy-map interface e0/1`.  
 А так будет легче увидеть где растут счетчики:`sh policy-map interface e0/1 | i Class-map|packets,`  
Ниже описаны политики, которые нужно настроить на маршрутизаторах r2, r3, r4.

На маршрутизаторе R2 создать такую входящую политику, с названием VLAN12 \(порядок правил должен соблюдаться\):

1. UDP пакеты из VLAN 12, с портами получателя в диапазоне 16384-18000 и размером от 40 до 60 byte:

* для описания пакетов использовать ACL. Назвать ACL: VOIP
* явно указать, что пакеты идут из VLAN 12
* для class-map использовать название VOIP
* пакеты должны быть промаркированы значением IP Precedence 5

2. HTTP трафик из VLAN 12:

* для описания HTTP пакетов использовать существующий расширенный ACL: HTTP \(его нельзя менять\)
* явно указать, что пакеты идут из VLAN 12
* для class-map использовать название HTTP
* пакеты должны быть промаркированы значением IP Precedence 3

3. ICMP пакеты из VLAN 12, размер которых больше чем 1400 byte:

* для описания ICMP пакетов использовать существующий расширенный ACL: ICMP \(его нельзя менять\)
* явно указать, что пакеты идут из VLAN 12
* для class-map использовать название ICMP
* пакеты должны быть промаркированы значением IP Precedence 2

4. Остальные пакеты с ненулевым значением IP Precedence, должны быть перемаркированы значением IP Precedence 1

* явно указать, что пакеты идут из VLAN 12 \(уточнение в 21:50 МСК 31.05\)
* для class-map использовать название NONDEFAULT \(уточнение в 21:50 МСК 31.05\)
* попробуйте в class-map описать эти «остальные пакеты с ненулевым значением IP Precedence» одной строкой

На маршрутизаторе R2 создать такую исходящую политику, с названием OUT \(порядок правил должен соблюдаться\):

1. Пакеты со значением IP Precedence 5:

* явно указать, что пакеты идут в VLAN 23
* для class-map использовать название IPPREC5
* пакеты должны передаваться с наивысшим приоритетом. Выделить для них 20% от пропускной способности интерфейса

2. Пакеты со значением IP Precedence 3:

* явно указать, что пакеты идут в VLAN 23
* для class-map использовать название IPPREC3
* выделить для них 15% от пропускной способности интерфейса

3. Пакеты со значением IP Precedence 2:

* явно указать, что пакеты идут в VLAN 23
* для class-map использовать название IPPREC2
* выделить для них 5% от пропускной способности интерфейса

4. Пакеты со значением IP Precedence 1:

* явно указать, что пакеты идут в VLAN 23
* для class-map использовать название IPPREC1
* выделить для них 30% от пропускной способности интерфейса

5. Включить в class-default WRED с такими параметрами:

* использовать значения IP Precedence для распределения веса в WRED
* для пакетов со значение IP Precedence равным 5 и 6 изменить настройки по умолчанию:
  * WRED должен начать отбрасывать пакеты, при условии, что средний размер очереди находится между 101 и 102. Отбрасываться должен каждый 10 пакет
  * При необходимости, увеличить размер очереди 

На маршрутизаторе R3 создать такую исходящую политику, с названием OUT \(порядок правил должен соблюдаться\):

1. Пакеты со значением IP Precedence 5:

* явно указать, что пакеты идут в VLAN 34
* для class-map использовать название IPPREC5
* пакеты должны передаваться с наивысшим приоритетом. Выделить для них 20% от пропускной способности интерфейса
* пакеты должны быть промаркированы значением DSCP EF

2. Пакеты со значением IP Precedence 3:

* явно указать, что пакеты идут в VLAN 34
* для class-map использовать название IPPREC3
* выделить для них 15% от пропускной способности интерфейса
* пакеты должны быть промаркированы значением DSCP AF41

3. Пакеты со значением IP Precedence 2:

* явно указать, что пакеты идут в VLAN 34
* для class-map использовать название IPPREC2
* выделить для них 5% от пропускной способности интерфейса
* пакеты должны быть промаркированы значением DSCP AF31

4. Пакеты со значением IP Precedence 1:

* явно указать, что пакеты идут в VLAN 34
* для class-map использовать название IPPREC1
* выделить для них 30% от пропускной способности интерфейса
* пакеты должны быть промаркированы значением DSCP AF21

5. Включить в class-default WRED с такими параметрами:

* использовать значения DSCP для распределения веса в WRED
* для пакетов со значение DSCP равным AF41 и EF изменить настройки по умолчанию:
  * WRED должен начать отбрасывать пакеты, при условии, что средний размер очереди находится между 101 и 102. Отбрасываться должен каждый 10 пакет
  * При необходимости, увеличить размер очереди

На маршрутизаторе R4 создать такую исходящую политику, с названием OUT \(порядок правил должен соблюдаться\):

1. Пакеты со значением DSCP EF:

* явно указать, что пакеты идут в VLAN 456
* для class-map использовать название EF
* пакеты должны передаваться с наивысшим приоритетом. Выделить для них 20% от пропускной способности интерфейса

2. Пакеты со значением DSCP AF41:

* явно указать, что пакеты идут в VLAN 456
* для class-map использовать название AF41
* выделить для них 15% от пропускной способности интерфейса

3. Пакеты со значением DSCP AF31:

* явно указать, что пакеты идут в VLAN 456
* для class-map использовать название AF31
* выделить для них 5% от пропускной способности интерфейса

4. Пакеты со значением DSCP AF21:

* явно указать, что пакеты идут в VLAN 456
* для class-map использовать название AF21
* выделить для них 30% от пропускной способности интерфейса

5. Включить в class-default WRED с такими параметрами:

* использовать значения DSCP для распределения веса в WRED
* для пакетов со значение DSCP равным AF41 и EF изменить настройки по умолчанию:
  * WRED должен начать отбрасывать пакеты, при условии, что средний размер очереди находится между 101 и 102. Отбрасываться должен каждый 10 пакет
  * При необходимости, увеличить размер очереди 

{% file src="../../../.gitbook/assets/lab022\_task2\_answers.zip" caption="Конечная конфигурация" %}

