# Задание №10 по большой лабе 2

В задании необходимо настроить:

* политики QoS для трафика в направлении от r10 к r5.
* политики настраиваются на r9, r8, r7, r2, r3, r4 и проверяются с r10, отправляя трафик на r5.
* в обратном направлении, политики настраивать не нужно.

Легенда задания:

* Маршрутизатор r9 находится ближе всего к клиенту \(r10\), поэтому на нем выполняем классификацию пакетов и маркировку их DSCP
* На всех маршрутизаторах, для одного и того же типа трафика, настроена одна и та же политика обслуживания на выход
* В сети есть два типа трафика:
  * бизнес-трафик \(сокращение в объектах BS\)
    * VLAN’ы 201-203
  * enterprise-трафик \(сокращение в объектах ENT\)
    * VLAN’ы 211-213
* Между r9 и r10, для проверки QoS, созданы дополнительные интерфейсы:
  * e0/1.201-203 для проверки политик для BS трафика
  * e0/1.211-213 для проверки политик для ENT трафика

Ниже описаны политики, которые нужно настроить на маршрутизаторах r9, r8, r7, r2, r3, r4.  
На маршрутизаторе R9 создать такую входящую политику, с названием IN\_QOS \(порядок правил должен соблюдаться\):

1. UDP пакеты из VLAN’ов 201, 202 или 203, с портами получателя в диапазоне 16384-18000:

* для описания пакетов использовать существующий ACL: VOIP
* явно указать, что пакеты идут из VLAN’ов 201, 202 или 203
  * объединить VLAN’ы в class-map. Назвать class-map BS\_VLAN
* для class-map использовать название BS\_VOIP
* пакеты должны быть промаркированы значением DSCP EF \(используйте вариант set ip dscp\)

2. HTTP трафик из VLAN’ов 201, 202 или 203:

* для описания HTTP пакетов использовать существующий ACL: HTTP
* явно указать, что пакеты идут из VLAN’ов 201, 202 или 203
  * использовать для этого созданную class-map BS\_VLAN
* для class-map использовать название BS\_HTTP
* пакеты должны быть промаркированы значением DSCP AF31 \(используйте вариант set ip dscp\)

3. ICMP пакеты из VLAN’ов 201, 202 или 203:

* для описания пакетов использовать существующий ACL: ICMP
* явно указать, что пакеты идут из VLAN’ов 201, 202 или 203
  * использовать для этого созданную class-map BS\_VLAN
* для class-map использовать название BS\_ICMP
* пакеты должны быть промаркированы значением DSCP AF21 \(используйте вариант set ip dscp\)

4. UDP пакеты из VLAN’ов 211, 212 или 213, с портами получателя в диапазоне 16384-18000:

* для описания пакетов использовать существующий ACL VOIP
* явно указать, что пакеты идут из VLAN’ов 211, 212 или 213
  * объединить VLAN’ы в class-map. Назвать class-map ENT\_VLAN
* для class-map использовать название ENT\_VOIP
* пакеты должны быть промаркированы значением DSCP AF41 \(используйте вариант set ip dscp\)

5. HTTP трафик из VLAN’ов 211, 212 или 213:

* для описания пакетов использовать существующий ACL HTTP
* явно указать, что пакеты идут из VLAN’ов 211, 212 или 213
  * использовать для этого созданную class-map ENT\_VLAN
* для class-map использовать название ENT\_HTTP
* пакеты должны быть промаркированы значением DSCP AF32 \(используйте вариант set ip dscp\)

6. ICMP пакеты из VLAN’ов 211, 212 или 213:

* для описания пакетов использовать существующий ACL ICMP
* явно указать, что пакеты идут из VLAN’ов 211, 212 или 213
  * использовать для этого созданную class-map ENT\_VLAN
* для class-map использовать название ENT\_ICMP
* пакеты должны быть промаркированы значением DSCP AF11 \(используйте вариант set ip dscp\)

7. Остальные пакеты из VLAN’ов 211, 212 или 213, с ненулевым значением DSCP:

* явно указать, что пакеты идут из VLAN’ов 211, 212 или 213
  * использовать для этого созданную class-map ENT\_VLAN
* для class-map использовать название ENT\_NON\_DEFAULT
* перемаркировать пакеты значением DSCP 0 \(используйте вариант set ip dscp\)

8. Применить политику на интерфейс e0/1

На маршрутизаторе R8 и r9 создать такую исходящую политику, с названием OUT \(порядок правил должен соблюдаться\):

1. Для трафика BS и ENT на выход должно быть разделение пропускной способности 70%/30% \(BS 70% / ENT 30%\)  
_Подсказка: для этого нужно будет создать иерархическую политику_

2. Для BS трафика создаем политику с названием BS\_QOS. В этой политике:

* Пакеты со значением DSCP EF:
  * для class-map использовать название EF
  * должны передаваться с наивысшим приоритетом. Выделить для них 10% пропускной способности \(так как политика иерархическая, то это будет 10% от 70%\)
* Пакеты со значением DSCP AF31:
  * для class-map использовать название AF31
  * должны передаваться с наивысшим приоритетом. Выделить для них 5% пропускной способности
* Пакеты со значением DSCP AF21:
  * для class-map использовать название AF21
  * выделить для них 35% пропускной способности
* Пакеты с ненулевым значением DSCP:
  * для class-map использовать название NON\_DEFAULT
  * выделить для них 25% пропускной способности
* Для всех остальных пакетов, включить WRED на основании DSCP с настройками по умолчанию

3. Для ENT трафика создаем политику с названием ENT\_QOS. В этой политике:

* Пакеты со значением DSCP AF41:
  * для class-map использовать название AF41
  * должны передаваться с наивысшим приоритетом. Выделить для них 10% пропускной способности \(так как политика иерархическая, то это будет 10% от 30%\)
* Пакеты со значением DSCP AF32:
  * для class-map использовать название AF32
  * должны передаваться с наивысшим приоритетом. Выделить для них 5% пропускной способности
* Пакеты со значением DSCP AF11:
  * для class-map использовать название AF11
  * выделить для них 35% от пропускной способности интерфейса
* Для всех остальных пакетов, включить WRED на основании DSCP с настройками по умолчанию

4. Применить политику:

* на маршрутизаторе r9 на интерфейс e0/1.89
* на маршрутизаторе r8 на интерфейс e0/1.78

На маршрутизаторе R7 создать разные исходящие политики, для разных туннелей:

1. Для туннеля между r7 и r2:

* Для трафика BS и ENT на выход должно быть разделение пропускной способности 50%/50% \(BS 50% / ENT 50%\). Назвать политику OUT72

2. Для туннеля между r7 и r3:

* Для трафика BS и ENT на выход должно быть разделение пропускной способности 60%/40% \(BS 60% / ENT 40%\). Назвать политику OUT73

3. Для туннеля между r7 и r4:

* Для трафика BS и ENT на выход должно быть разделение пропускной способности 70%/30% \(BS 70% / ENT 30%\). Назвать политику OUT74

4. Политики применить к соответствующим туннелям  
_Подсказка: бывают еще более иерархические политики. Если вам понадобился еще один уровнять иерархии, добавьте к названию самой верхней политики приставку TUN\__

5. Вложенные политики для BS и ENT трафика, аналогичны политике на r8 и r9  
На маршрутизаторах r2, r3, r4 создать исходящие политики:

1. Вложенные политики для BS и ENT трафика, аналогичны политикам на r8 и r9  
2. Процентное соотношение между BS и ENT должно соответствовать аналогичному соотношению в туннеле  
3. Применить политики на исходящие логические интерфейсы \(subinterface\) по пути к r5 \(на r4 применить к интерфейсу e0/1.34\).

Проверить политики с r10 самостоятельно \(для UDP пакетов на r10 создан IP SLA тест\).  
Убедиться, что трафик одного типа попадает во все соответствующие классы.  
  


